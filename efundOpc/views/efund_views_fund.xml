<odoo>
    <!-- =====================================================
         3️⃣  VUE TREE
    ====================================================== -->
    <record id="view_fund_fund_list" model="ir.ui.view">
        <field name="name">fund.fund.list</field>
        <field name="model">efund.fund</field>
        <field name="arch" type="xml">
            <list string="Funds" decoration-danger="state == 'liquidated'" decoration-warning="state == 'suspended'">
                <field name="company_id"/>
                <field name="management_company_id"/>
                <field name="fund_type_id"/>
                <field name="risk_level"/>
                <field name="nav_frequency"/>
                <field name="launch_date"/>
                <field name="ter"/>
                <field name="state"/>
                <button name="action_initial_valuation"
                        type="object"
                        class="btn-outline-primary"
                        string="Valorisation Initiale"
                        invisible="state != 'draft'"/>
            </list>
        </field>
    </record>

    <!-- =====================================================
         4️⃣  VUE FORM
    ====================================================== -->
    <record id="view_fund_fund_form" model="ir.ui.view">
        <field name="name">efund.fund.form</field>
        <field name="model">efund.fund</field>
        <field name="arch" type="xml">
            <form string="Fonds" create="true" edit="true">
                <header>
                    <button name="action_activate" type="object" string="Activate" invisible="state != 'draft'"
                            class="btn-primary"/>
                    <button name="action_suspend" type="object" string="Suspend" invisible="state != 'active'"
                            class="btn-warning"/>
                    <button name="action_liquidate" type="object" string="Liquidate"
                            invisible="state != 'active' or state != 'suspended'" class="btn-danger"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,active,suspended,liquidated"/>
                </header>

                <sheet>
                    <group>
                        <group string="Informations Génerales">
                            <field name="name"/>
                            <field name="fund_type_id"/>
                            <field name="risk_level"/>
                            <field name="nav_frequency"/>
                        </group>

                        <group string="Informations financières">
                            <field name="initial_nav"/>
                            <field name="initial_price"/>
                            <field name="current_vl"/>
                            <field name="allow_fractional_parts" />

                        </group>

                        <group string="Cadre Réglementaire">
                            <field name="license_number"/>
                            <field name="license_date"/>
                            <field name="info_visa_number"/>
                        </group>

                        <group string="Frais, Taxes et Commissions">
                            <field name="taf_rate"/>
                            <field name="subscription_fee_rate"/>
                            <field name="redemption_fee_rate"/>
                            <field name="retro_subscription_rate"/>
                            <field name="retro_redemption_rate"/>
                        </group>

                    </group>
                    <notebook>
                        <!--<page string="Informations Réglementaires">

                             <group>
                                 <group string="Agréments">
                                     <field name="regulateur"/>
                                     <field name="agrement_date"/>
                                     <field name="dossier_reglementaire_id"/>
                                 </group>
                             </group>

                        </page>
                        <page string="Gestion Opérationnelle">

                        </page>
                        <page string="Valeur du fonds">

                        </page>
                        -->
                        <page string="Profil du Fond">
                            <group string="Profil du Fond">
                                <field name="fund_type_id"/>
                                <field name="target_investors"/>
                                <field name="investment_horizon"/>
                            </group>
                        </page>

                        <page string="Paramètre comptable">
                            <group>
                                <group string="Paramètre comptable">
                                    <field name="cash_account_id"/>
                                    <field name="capital_account_id"/>
                                    <field name="subscription_account_id"/>
                                    <field name="redemption_account_id"/>
                                    <field name="fee_income_account_id"/>
                                    <field name="currency_id" readonly="1" string="Monnaie"/>
                                </group>

                                <group string="Fund Journals Configuration">
                                    <field name="subscription_journal_id"/>
                                    <field name="redemption_journal_id"/>
                                    <field name="operations_journal_id"/>
                                </group>
                            </group>
                        </page>

                        <page string="Parts">
                            <group string="Parts">
                                    <field name="initial_units"/>
                                    <field name="opening_units"/>
                                    <field name="current_units"/>
                            </group>
                        </page>

                        <page string="Catégorie de parts">
                            <field name="share_class_ids" create="true" edit="true">
                                <list editable="bottom">
                                    <field name="name"/>
                                    <field name="fee_structure"/>
                                    <field name="management_fee_rate"/>
                                    <field name="redemption_fee_rate"/>
                                    <field name="performance_fee_rate"/>
                                    <field name="is_accumulating"/>
                                    <field name="minimum_subscription"/>
                                    <field name="minimum_additional_subscription"/>
                                    <field name="minimum_redemption"/>
                                    <field name="total_shares" readonly="1"/>
                                    <field name="total_net_assets" readonly="1"/>
                                    <field name="current_nav" readonly="1"/>
                                </list>
                            </field>
                        </page>
                        <page string="Acteurs du Fonds">
                            <group string="Acteurs du Fonds">
                                    <field name="depositary_id"/>
                                    <field name="manager_id"/>
                            </group>
                        </page>

                        <page string="Exercice et Calculs">
                            <group string="Exercice et Calculs">
                                    <field name="nav_calculation_period"/>
                                    <field name="fiscal_year_start"/>
                                    <field name="fiscal_year_end"/>
                                    <field name="next_nav_date"/>
                            </group>
                        </page>
                        <!-- MODIFICATION DE efund_views_fund.xml -->
                        <!-- Ajouter cet onglet dans le notebook existant -->
                        <page string="Portfolio / Positions">
                                <button name="action_open_position_wizard"
                                        type="object"
                                        string="Ajouter une position"
                                        class="oe_highlight"
                                        icon="fa-plus-circle"/>
                                <button name="action_import_positions"
                                        type="object"
                                        string="Importer positions"
                                        class="btn-primary"
                                        icon="fa-upload"/>
                                <button name="action_portfolio_report"
                                        type="object"
                                        string="Rapport portfolio"
                                        class="btn-info"
                                        icon="fa-bar-chart"/>

                            <group>
                                <group string="Resumé du portfolio">
                                    <field name="total_market_value"/>
                                    <field name="position_count"/>
                                    <field name="total_unrealized_pl"/>
                                    <field name="last_valuation_date"/>
                                </group>
                            </group>
                            <!-- Liste des positions -->
                            <field name="position_ids">
                                <list string="Positions du fonds">
                                    <field name="instrument_id"/>
                                    <field name="valuation_date"/>
                                    <field name="quantity"/>
                                    <field name="avg_cost"/>
                                    <field name="last_price"/>
                                    <field name="market_value"/>
                                    <field name="unrealized_pl"/>
                                    <field name="unrealized_pl_percent" widget="progressbar"/>
                                    <field name="state" widget="badge"/>
                                    <button name="action_update_position" type="object" string="Modifier"
                                            class="oe_highlight" invisible="state == 'closed'"/>
                                    <button name="action_close_position" type="object" string="Clôturer"
                                            invisible="state == 'closed'"/>
                                </list>
                            </field>
                        </page>

                    </notebook>
                </sheet>

                <chatter>
                    <field name="message_follower_ids"/>
                    <field name="message_ids"/>
                </chatter>
            </form>
        </field>
    </record>
    <!-- =====================================================
         5️⃣  VUE KANBAN
    ====================================================== -->
    <record id="view_efund_fund_kanban" model="ir.ui.view">
        <field name="name">efund.fund.kanban</field>
        <field name="model">efund.fund</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state" class="o_kanban_small_column">
                <field name="company_id"/>
                <field name="fund_type_id"/>
                <field name="risk_level"/>
                <field name="state"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click o_kanban_card">
                            <div class="o_kanban_details">
                                <strong>
                                    <field name="company_id"/>
                                </strong>
                                <div>
                                    <span class="text-muted">Type:</span>
                                    <field name="fund_type_id"/>
                                </div>
                                <div>
                                    <span class="text-muted">Risk:</span>
                                    <field name="risk_level"/>
                                </div>
                                <div>
                                    <span class="text-muted">NAV Freq:</span>
                                    <field name="nav_frequency"/>
                                </div>
                                <div>
                                    <span class="text-muted">TER:</span>
                                    <field name="ter"/>
                                </div>
                            </div>
                            <div class="oe_kanban_footer">
                                <span class="badge" t-attf-class="bg-{{ record.state.raw_value }}">
                                    <field name="state"/>
                                </span>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

</odoo>