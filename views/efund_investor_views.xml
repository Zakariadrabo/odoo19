<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ========================= -->
    <!--  ACTION PRINCIPALE       -->
    <!-- ========================= -->
    <record id="action_efund_investor" model="ir.actions.act_window">
        <field name="name">Investors</field>
        <field name="res_model">efund.investor</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create and manage your fund investors here.
            </p>
        </field>
    </record>


    <record id="view_efund_investor_form" model="ir.ui.view">
        <field name="name">efund.investor.form</field>
        <field name="model">efund.investor</field>
        <field name="arch" type="xml">
            <form string="Investor" create="true" edit="true">
                <header>
                    <button name="%(action_efund_aml_alert)d"
                            type="action"
                            class="oe_stat_button"
                            icon="fa-shield-alt">
                        <field string="AML Alerts" name="aml_alert_ids" widget="statinfo"/>
                    </button>
                    <field name="status" widget="statusbar"
                           statusbar_visible="draft,kyc_pending,kyc_approved,kyc_rejected,archived"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="partner_id"
                                   domain="[('is_investor', '=', True)]"
                                   context="{'default_is_investor': True}"
                                   options="{'no_create_edit': False}"/>
                            <field name="company_id"/>
                            <field name="kyc_level"/>
                            <field name="kyc_score"/>
                            <field name="risk_category"/>
                            <field name="whitelisted"/>
                        </group>
                        <group>
                            <field name="pep_flag"/>
                            <field name="sanctions_flag"/>
                            <field name="kyc_operator_id"/>
                            <field name="kyc_last_update"/>
                            <field name="active"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Comptes">
                            <group>
                                <group string="Compte Titre">
                                    <field name="account_part_ids">
                                        <list editable="bottom">
                                            <field name="name"/>
                                            <field name="account_number"/>
                                            <field name="total_parts"/>
                                            <field name="state"/>
                                        </list>
                                    </field>
                                </group>
                                <group string="Compte EspÃ¨ces">
                                    <field name="account_cash_ids">
                                        <list editable="bottom">
                                            <field name="name"/>
                                            <field name="account_number"/>
                                            <field name="balance"/>
                                            <field name="state"/>
                                        </list>
                                    </field>
                                </group>
                            </group>
                        </page>
                        <page string="Notes">
                            <field name="notes" placeholder="Add remarks or observations..."/>
                        </page>
                        <page string="KYC Documents">
                            <field name="document_ids" create="true" edit="true">
                                <list editable="bottom">
                                    <field name="name"/>
                                    <field name="document_type"/>
                                    <field name="issued_date"/>
                                    <field name="expiry_date"/>
                                    <field name="status"/>
                                    <field name="file_name"/>
                                    <field name="file_data" widget="binary" filename="file_name"/>
                                </list>
                            </field>
                        </page>

                        <page string="KYC Checks">
                            <field name="kyc_check_ids" create="true" edit="true">
                                <list editable="bottom">
                                    <field name="check_type"/>
                                    <field name="result"/>
                                    <field name="checked_at"/>
                                    <field name="operator_id"/>
                                </list>
                            </field>
                        </page>
                        <page string="AML Alerts / Monitoring">
                            <group>
                                <group>
                                    <button name="%(action_efund_aml_alert)d"
                                            string="View All AML Alerts"
                                            type="action"
                                            class="btn-secondary"
                                            icon="fa-list"/>
                                    <button name="action_create_aml_alert"
                                            string="Create AML Alert"
                                            type="object"
                                            class="btn-primary"
                                            icon="fa-plus"/>
                                </group>
                            </group>

                            <field name="aml_alert_ids" nolabel="1">
                                <list editable="bottom" decoration-danger="severity=='critical'"
                                      decoration-warning="severity=='suspicious'" decoration-muted="status=='closed'">
                                    <field name="name"/>
                                    <field name="severity" widget="badge"/>
                                    <field name="status" widget="badge"/>
                                    <field name="score"/>
                                    <field name="assigned_to"/>
                                    <field name="created_at"/>
                                </list>
                            </field>

                            <group>
                                <separator string="Latest Alert Notes"/>
                                <field name="notes" placeholder="Notes or decisions taken during AML investigation..."/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>


</odoo>
